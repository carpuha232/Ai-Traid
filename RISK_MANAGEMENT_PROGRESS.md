# üõ°Ô∏è –ü—Ä–æ–≥—Ä–µ—Å—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ —Ä–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ:

### 1. –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å RiskManager (`core/risk_manager.py`)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

- ‚úÖ `_load_symbol_limits()` - –∑–∞–≥—Ä—É–∑–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä
- ‚úÖ `calculate_minimum_margin()` - —Ä–∞—Å—á–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –º–∞—Ä–∂–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã
- ‚úÖ `calculate_liquidation_price()` - —Ä–∞—Å—á–µ—Ç —Ü–µ–Ω—ã –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
- ‚úÖ `calculate_averaging_order_price()` - —Ä–∞—Å—á–µ—Ç —Ü–µ–Ω—ã –¥–ª—è –¥–æ–ª–∏–≤–æ—á–Ω–æ–≥–æ –æ—Ä–¥–µ—Ä–∞ (–∑–∞ 10% –¥–æ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏)
- ‚úÖ `calculate_stepped_stop_loss()` - –ª–æ–≥–∏–∫–∞ —Å—Ç—É–ø–µ–Ω—á–∞—Ç–æ–≥–æ stop-loss –≤ –ø—Ä–∏–±—ã–ª–∏
- ‚úÖ `calculate_stop_price_from_pnl()` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PNL% –≤ —Ü–µ–Ω—É —Å—Ç–æ–ø–∞

**–õ–æ–≥–∏–∫–∞ —Å—Ç—É–ø–µ–Ω—á–∞—Ç–æ–≥–æ stop-loss:**
```
PNL 10-30%  ‚Üí Stop –Ω–∞ 15%
PNL 30-40%  ‚Üí Stop –Ω–∞ 40%
PNL 40-50%  ‚Üí Stop –Ω–∞ 30%
PNL 50-60%  ‚Üí Stop –Ω–∞ 40%
PNL 60-70%  ‚Üí Stop –Ω–∞ 50%
PNL 70-80%  ‚Üí Stop –Ω–∞ 60%
PNL 80-90%  ‚Üí Stop –Ω–∞ 90%
PNL 90%+    ‚Üí Stop –Ω–∞ 90%
```

### 2. –†–∞—Å—à–∏—Ä–µ–Ω dataclass Position

**–ù–æ–≤—ã–µ –ø–æ–ª—è:**
- `initial_margin` - –Ω–∞—á–∞–ª—å–Ω–∞—è –º–∞—Ä–∂–∞
- `initial_entry_price` - –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –≤—Ö–æ–¥–∞
- `averaging_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∏–≤–æ–∫
- `total_margin` - –æ–±—â–∞—è –º–∞—Ä–∂–∞ –ø–æ—Å–ª–µ –¥–æ–ª–∏–≤–æ–∫
- `averaging_order_id` - ID –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ—Ä–¥–µ—Ä–∞ –Ω–∞ –¥–æ–ª–∏–≤–∫—É
- `stepped_stop_active` - –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –ª–∏ —Å—Ç—É–ø–µ–Ω—á–∞—Ç—ã–π —Å—Ç–æ–ø
- `stepped_stop_level_pnl` - —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å —Å—Ç–æ–ø–∞ –≤ % PNL
- `stepped_stop_order_id` - ID –ª–∏–º–∏—Ç–Ω–æ–≥–æ stop-loss –æ—Ä–¥–µ—Ä–∞

---

## üöß –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –¥–æ–¥–µ–ª–∞—Ç—å:

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ LiveTrader

**–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å:**

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è RiskManager** –≤ `__init__`
2. **–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `calculate_minimum_margin()` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞
   - –í—ã–∑–≤–∞—Ç—å `calculate_liquidation_price()` –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Position
   - –†–∞–∑–º–µ—Å—Ç–∏—Ç—å –ª–∏–º–∏—Ç–Ω—ã–π –æ—Ä–¥–µ—Ä –Ω–∞ –¥–æ–ª–∏–≤–∫—É —á–µ—Ä–µ–∑ `place_averaging_order()`
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å `initial_margin`, `initial_entry_price`, `total_margin`

3. **Continuous monitoring loop:**
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å PNL –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏
   - –û–±–Ω–æ–≤–ª—è—Ç—å stepped stop-loss –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —É—Ä–æ–≤–Ω–µ–π
   - –†–∞–∑–º–µ—â–∞—Ç—å/–æ–±–Ω–æ–≤–ª—è—Ç—å –ª–∏–º–∏—Ç–Ω—ã–µ stop-loss –æ—Ä–¥–µ—Ä–∞

4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è averaging –æ—Ä–¥–µ—Ä–æ–≤:**
   - –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ–ª–∏–≤–æ—á–Ω–æ–≥–æ –æ—Ä–¥–µ—Ä–∞
   - –û–±–Ω–æ–≤–∏—Ç—å `averaging_count`, `total_margin`
   - –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å—Ä–µ–¥–Ω—é—é —Ü–µ–Ω—É –≤—Ö–æ–¥–∞
   - –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å liquidation_price
   - –†–∞–∑–º–µ—Å—Ç–∏—Ç—å –Ω–æ–≤—ã–π averaging –æ—Ä–¥–µ—Ä (–µ—Å–ª–∏ –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç)

### 4. –°–æ–∑–¥–∞—Ç—å OrderManager

**–§—É–Ω–∫—Ü–∏–∏:**
- `place_limit_order()` - —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –ª–∏–º–∏—Ç–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤
- `cancel_order()` - –æ—Ç–º–µ–Ω–∞ –æ—Ä–¥–µ—Ä–æ–≤
- `check_order_status()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- `update_stepped_stop()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ stepped stop-loss

### 5. –î–æ–±–∞–≤–∏—Ç—å –≤ config.json

**–ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
"risk_management": {
  "use_averaging": true,
  "averaging_distance_pct": 10.0,
  "max_averaging_count": 3,
  "max_margin_per_position_pct": 20.0,
  "use_stepped_stop": true,
  "stepped_stop_activation_pnl": 10.0,
  "maintenance_margin_rate": 0.004
}
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

### –í–∞—Ä–∏–∞–Ω—Ç –ê: –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–ª–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å RiskManager –≤ LiveTrader
- –î–æ–±–∞–≤–∏—Ç—å OrderManager
- –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã

### –í–∞—Ä–∏–∞–Ω—Ç –ë: –¢–µ—Å—Ç–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –±–∞–∑–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ä–∞—Å—á–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –º–∞—Ä–∂–∏
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ liquidation price
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –±–æ—Ç–µ
- –ü–æ—Ç–æ–º –¥–æ–±–∞–≤–∏—Ç—å averaging –∏ stepped stop

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:

### –†–∏—Å–∫–∏ —Å–∏—Å—Ç–µ–º—ã –º–∞—Ä—Ç–∏–Ω–≥–µ–π–ª–∞ (averaging):
1. **–ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –¥–æ–ª–∏–≤–æ–∫** - –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –≤–µ—Å—å –±–∞–ª–∞–Ω—Å
2. **–¢—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –±–∞–ª–∞–Ω—Å** - –∏–Ω–∞—á–µ –ª–∏–∫–≤–∏–¥–∞—Ü–∏—è –¥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è averaging –æ—Ä–¥–µ—Ä–∞
3. **–†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –±–æ–∫–æ–≤–∏–∫–µ** - –≤ —Å–∏–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–¥–µ –≤—Å–µ –¥–æ–ª–∏–≤–∫–∏ –±—É–¥—É—Ç —É–±—ã—Ç–æ—á–Ω—ã

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å `max_averaging_count` = 3-5 –º–∞–∫—Å–∏–º—É–º
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å `max_margin_per_position_pct` = 10-20% –±–∞–ª–∞–Ω—Å–∞
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞ –Ω–∞ –º–∞–ª–æ–º –±–∞–ª–∞–Ω—Å–µ ($50-100)

---

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å TODO:

- ‚úÖ –†–∞—Å—á–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –º–∞—Ä–∂–∏
- ‚úÖ –†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏  
- üöß –õ–∏–º–∏—Ç–Ω—ã–π –æ—Ä–¥–µ—Ä –Ω–∞ –¥–æ–ª–∏–≤–∫—É
- ‚è≥ –°—Ç—É–ø–µ–Ω—á–∞—Ç—ã–π stop-loss
- ‚è≥ –¢—Ä–µ–∫–∏–Ω–≥ –¥–æ–ª–∏–≤–æ–∫
- ‚è≥ –ú–µ–Ω–µ–¥–∂–µ—Ä –æ—Ä–¥–µ—Ä–æ–≤
- ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

---

**–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å? –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –ê –∏–ª–∏ –ë!**


